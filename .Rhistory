# }
# if(.args[2] == "sars1"){
#
# }
# if(.args[2] == "ebola"){
#
# }
baseline_vals_raw <- read_excel(.args[2])
baseline_vals_raw$ps
# Read Parameter values for SARS-Cov-2.
baseline_vals <- c(ps = as.numeric(baseline_vals_raw$ps),
du = as.numeric(baseline_vals_raw$du),
cc = as.numeric(baseline_vals_raw$cc))
out <- run_covid(
t = time_seq,
pp = parm_values,
vals = baseline_vals,
statev = state_var, ret_cm = FALSE
)
library(readxl)
load("~/SACEMAProject/Project/Project_Msc/data/sars_cov_2.RData")
load("~/SACEMAProject/Project/Project_Msc/data/sars_cov_2.RData")
q()
source("~/SACEMAProject/Project/Project_Msc/scripts/functions.R")
source("~/SACEMAProject/Project/Project_Msc/scripts/inputs.R")
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
"./data/sars_cov_2_baseline.xlsx",
"./output/sars_cov_2_cm_outputs.RData")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
# Run the model to produce all rates of a disease at baseline
# base_sar2 <- c(ps=.75, du = 15, cc = 20)
baseline_output <- run_covid(
t = time_seq,
pp = parm_values,
vals = baseline_vals,
statev = state_var, ret_cm = FALSE
)
if (file.exists("./output/sars_cov_2_cm_outputs.RData")) {
load("./output/sars_cov_2_cm_outputs.RData")
} else{
cm_res <- sapply(1:nrow(new_vals), function(ii) {
run_covid(
t = time_seq,
pp = parm_values,
vals = new_vals[ii, ],
statev = state_var
)
})
}
new_df <- cbind(new_vals, cm = cm_res)
target <- tail(.args, 1)
save(c(baseline_output, new_df), file = target)
save(list = c(baseline_output, new_df), file = target)
save(baseline_output, new_df, file = target)
load("~/SACEMAProject/Project/Project_Msc/output/sars_cov_2_cm_outputs.RData")
load("~/SACEMAProject/Project/Project_Msc/data/sars_cov_2.RData")
save(list = ls(), file = target)
source("~/SACEMAProject/Project/Project_Msc/scripts/functions.R")
source("~/SACEMAProject/Project/Project_Msc/scripts/inputs.R")
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
#"./data/sars_cov_2_baseline.xlsx",
"./output/sars_cov_2_cm_outputs.RData")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
# Run the model to produce all rates of a disease at baseline
# base_sar2 <- c(ps=.75, du = 15, cc = 20)
baseline_output <- run_covid(
t = time_seq,
pp = parm_values,
vals = baseline_vals,
statev = state_var, ret_cm = FALSE
)
if (file.exists("./output/sars_cov_2_cm_outputs.RData")) {
load("./output/sars_cov_2_cm_outputs.RData")
} else{
cm_res <- sapply(1:nrow(new_vals), function(ii) {
run_covid(
t = time_seq,
pp = parm_values,
vals = new_vals[ii, ],
statev = state_var
)
})
}
new_df <- cbind(new_vals, cm = cm_res)
new_df <- cbind(new_vals, cm = cm_res)
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
#"./data/sars_cov_2_baseline.xlsx",
"./output/sars_cov_2_outputs.RData")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
target <- tail(.args, 1)
target
source("~/SACEMAProject/Project/Project_Msc/scripts/functions.R")
source("~/SACEMAProject/Project/Project_Msc/scripts/inputs.R")
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
#"./data/sars_cov_2_baseline.xlsx",
"./output/sars_cov_2_outputs.RData")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
target <- tail(.args, 1)
# Run the model to produce all rates of a disease at baseline
# base_sar2 <- c(ps=.75, du = 15, cc = 20)
baseline_output <- run_covid(
t = time_seq,
pp = parm_values,
vals = baseline_vals,
statev = state_var, ret_cm = FALSE
)
run_covid(
t = time_seq,
pp = parm_values,
vals = new_vals[3, ],
statev = state_var
)
if (file.exists(target)) {
load(target)
} else{
cm_res <- sapply(1:nrow(new_vals), function(ii) {
run_covid(
t = time_seq,
pp = parm_values,
vals = new_vals[ii, ],
statev = state_var
)
})
}
new_df <- cbind(new_vals, cm = cm_res)
save(list = ls(), file = target)
new_vals
new_vals[2, ]
sapply(1:3, function(ii){ii^2})
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
"./functions/functions.RData",
"./output/sars_cov_2_outputs.RData")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
library(deSolve)
target <- tail(.args, 1)
# Source the inputs
load(.args[[1]])
sars_cov_2_outputs <- readRDS("~/SACEMAProject/Project/Project_Msc/output/sars_cov_2_outputs.rds")
View(sars_cov_2_outputs)
View(sars_cov_2_outputs)
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
"./functions/functions.RData",
"./output/sars_cov_2_outputs.rds")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
sars_cov_2_outputs <- readRDS("~/SACEMAProject/Project/Project_Msc/output/sars_cov_2_outputs.rds")
View(sars_cov_2_outputs)
load("~/SACEMAProject/Project/Project_Msc/data/sars_cov_2.RData")
sars_cov_2_outputs <- readRDS("~/SACEMAProject/Project/Project_Msc/output/sars_cov_2_outputs.rds")
View(sars_cov_2_outputs)
source("~/SACEMAProject/Project/Project_Msc/scripts/functions.R")
source("~/SACEMAProject/Project/Project_Msc/scripts/inputs.R")
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
"./functions/functions.RData",
"./output/sars_cov_2_outputs.rds")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
library(deSolve)
target <- tail(.args, 1)
# Source the inputs
load(.args[[1]])
load(.args[[2]])
# Run the model to produce all rates of a disease at baseline
# base_sar2 <- c(ps=.75, du = 15, cc = 20)
baseline_output <- run_covid(
t = time_seq,
pp = parm_values,
vals = baseline_vals,
statev = state_var, ret_cm = FALSE
)
cm_res <- sapply(1:5, function(ii) {
run_covid(
t = time_seq,
pp = parm_values,
vals = new_vals[ii, ],
statev = state_var
)
})
cum_mortality_df <- cbind(new_vals, cm = cm_res)
saveRDS(object = cum_mortality_df, file = target)
sars_cov_2_outputs <- readRDS("~/SACEMAProject/Project/Project_Msc/output/sars_cov_2_outputs.rds")
View(sars_cov_2_outputs)
load("~/SACEMAProject/Project/Project_Msc/output/ebola_outputs.RData")
load("~/SACEMAProject/Project/Project_Msc/output/sars_cov_2_outputs.RData")
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
"./functions/functions.RData",
"./output/sars_cov_2_outputs.RData")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
library(deSolve)
target <- tail(.args, 1)
load(.args[[1]])
load(.args[[2]])
# Run the model to produce all rates of a disease at baseline
# base_sar2 <- c(ps=.75, du = 15, cc = 20)
baseline_output <- run_covid(
t = time_seq,
pp = parm_values,
vals = baseline_vals,
statev = state_var, ret_cm = FALSE
)
cm_res <- sapply(1:nrow(new_vals), function(ii) {
run_covid(
t = time_seq,
pp = parm_values,
vals = new_vals[ii, ],
statev = state_var
)
})
View(baseline_output)
View(baseline_output)
typeof(baseline_output)
typeof(cum_mortality_df)
cum_mortality_df <- cbind(new_vals, cm = cm_res)
save(cum_mortality_df, baseline_output, file = target)
if(file.exists(target)){
load(target)
} else{
cm_res <- sapply(1:nrow(new_vals), function(ii) {
run_covid(
t = time_seq,
pp = parm_values,
vals = new_vals[ii, ],
statev = state_var
)
})
## Combine used parameters with corresponding cm value and save it
cum_mortality_df <- cbind(new_vals, cm = cm_res)
save(cum_mortality_df, baseline_output, file = target)
}
.args <- if(interactive()){
c("./output/sars_cov_2_outputs.RData",  # inputs
"./figs/sars_cov_2_out.png")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
target <- tail(.args, 1)
library(ggplot2)
library(dplyr)
library(tidyr)
library(patchwork)
load(.args[[1]])
new_out <- baseline_output %>%
pivot_longer(S:CA, values_to = "Count", names_to = "States")
model_out <- (ggplot(new_out)
+
geom_line(aes(
x = time,
y = Count,
col = States
), size = 1)
+
labs(
x = "Time(days)"
, y = "Population"
, title = "Probability of surviving is 75%, 12 days of hospitalization
with 20 availabe beds in population of 150000 individuals."
)
+
facet_wrap(~States, scales = "free")
+
ggeasy::easy_center_title()
+
theme_bw()
)
print(model_out)
bed_capacity <- 20
baseline_cm <- function(bed_cap, psb = .71, dub = 19) cum_mortality_df %>%
filter(ps == psb, du == dub, cc == bed_cap)
baseline_cm
baseline_cm <- function(bed_cap, psb = .71, dub = 19) cum_mortality_df %>%
filter(ps == psb, du == dub, cc == bed_cap)
cum_mortality_df
plot1 <- (ggplot()
+
aes(x = ps, y = du, z = cm, color = as.character(cc)
)
+
geom_contour(breaks = c(min(new_df$cm), baseline_cm(bed_capacity)$cm, max(new_df$cm)), data = new_df[new_df$cc == bed_capacity, ])
+
geom_contour(breaks = c(min(new_df$cm), baseline_cm(180)$cm, max(new_df$cm)), data = new_df[new_df$cc == 180, ])
+
geom_point(data = baseline_cm(bed_capacity), size = 3, col = "blue")
+
lims(x = c(0, 1))
+
geom_vline(aes(xintercept = ps), data = baseline_cm(bed_capacity))
+
geom_hline(aes(yintercept = du), data = baseline_cm(bed_capacity))
+
labs(#title = "Cumulative mortality at given number of beds",
x = "Probablilty of surving"
, y = "Hospital duration (days)"
, color = "Number of beds")
+
theme_bw()
+
ggeasy::easy_center_title()
)
plot1 <- (ggplot()
+
aes(x = ps, y = du, z = cm, color = as.character(cc)
)
+
geom_contour(breaks = c(min(cum_mortality_df$cm),
baseline_cm(bed_capacity)$cm,
max(cum_mortality_df$cm)),
data = cum_mortality_df[cum_mortality_df$cc == bed_capacity, ])
+
geom_contour(breaks = c(min(cum_mortality_df$cm),
baseline_cm(180)$cm,
max(cum_mortality_df$cm)),
data = cum_mortality_df[cum_mortality_df$cc == 180, ])
+
geom_point(data = baseline_cm(bed_capacity), size = 3, col = "blue")
+
lims(x = c(0, 1))
+
geom_vline(aes(xintercept = ps), data = baseline_cm(bed_capacity))
+
geom_hline(aes(yintercept = du), data = baseline_cm(bed_capacity))
+
labs(#title = "Cumulative mortality at given number of beds",
x = "Probablilty of surving"
, y = "Hospital duration (days)"
, color = "Number of beds")
+
theme_bw()
+
ggeasy::easy_center_title()
)
plot1
plot1 <- (ggplot(new_out)
+
geom_line(aes(
x = time,
y = Count,
col = States
), size = 1)
+
labs(
x = "Time(days)"
, y = "Population"
, title = "Probability of surviving is 75%, 12 days of hospitalization
with 20 availabe beds in population of 150000 individuals."
)
+
facet_wrap(~States, scales = "free")
+
ggeasy::easy_center_title()
+
theme_bw()
)
bed_capacity <- 20
baseline_cm <- function(bed_cap, psb = .71, dub = 19) cum_mortality_df %>%
filter(ps == psb, du == dub, cc == bed_cap)
plot2 <- (ggplot()
+
aes(x = ps, y = du, z = cm, color = as.character(cc)
)
+
geom_contour(breaks = c(min(cum_mortality_df$cm),
baseline_cm(bed_capacity)$cm,
max(cum_mortality_df$cm)),
data = cum_mortality_df[cum_mortality_df$cc == bed_capacity, ])
+
geom_contour(breaks = c(min(cum_mortality_df$cm),
baseline_cm(180)$cm,
max(cum_mortality_df$cm)),
data = cum_mortality_df[cum_mortality_df$cc == 180, ])
+
geom_point(data = baseline_cm(bed_capacity), size = 3, col = "blue")
+
lims(x = c(0, 1))
+
geom_vline(aes(xintercept = ps), data = baseline_cm(bed_capacity))
+
geom_hline(aes(yintercept = du), data = baseline_cm(bed_capacity))
+
labs(#title = "Cumulative mortality at given number of beds",
x = "Probablilty of surving"
, y = "Hospital duration (days)"
, color = "Number of beds")
+
theme_bw()
+
ggeasy::easy_center_title()
)
save(plot1, plot2, file = target)
.args <- if(interactive()){
c("./output/sars_cov_2_outputs.RData",  # inputs
"./figs/sars_cov_2_figues.jpg")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
target <- tail(.args, 1)
save(plot1, plot2, file = target)
View(plot1)
plot1
plot2
?ggsave
?grepl
if(dir.exists("./figs")){
ggsave(filename = target,
plot = plot2,
width = 8.51,
height = 5.67,
units = "in")
}else{
dir.create("./figs")
ggsave(filename = target,
plot = plot2,
width = 8.51,
height = 5.67,
units = "in")
}
.args <- if(interactive()){
c("./output/sars_cov_2_outputs.RData",  # inputs
"./figs/sars_cov_2_plot.jpg")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
if(dir.exists("./figs")){
ggsave(filename = target,
plot = plot2,
width = 8.51,
height = 5.67,
units = "in")
}else{
dir.create("./figs")
ggsave(filename = target,
plot = plot2,
width = 8.51,
height = 5.67,
units = "in")
}
10000-4900
5100-800
4300-1500
.args <- if(interactive()){
c("./data/sars_cov_2.RData",  # inputs
"./functions/functions.RData",
"./output/sars_cov_2_outputs.RData")  # outputs
}else{
commandArgs(trailingOnly = TRUE)
}
library(dplyr)
library(deSolve)
target <- tail(.args, 1)
load(.args[[1]])
load(.args[[2]])
# Run the model to produce all rates of a disease at baseline
# base_sar2 <- c(ps=.75, du = 15, cc = 20)
baseline_output <- run_covid(
t = time_seq,
pp = parm_values,
vals = baseline_vals,
statev = state_var, ret_cm = FALSE
)
baseline_output
baseline_output
baseline_output$CA
head(baseline_output$CA)
plot(seq(o, 365, 1),baseline_output$CA)
plot(seq(0, 365, 1),baseline_output$CA)
plot(seq(0, 365, 10),baseline_output$CA)
plot(seq(0, 365, 9),baseline_output$CA)
plot(seq(0, 365, 12),baseline_output$CA)
plot(seq(0, 365, 1),baseline_output$CA)
tail(baseline_output$CA)
filter(baseline_output$CA)
baseline_output %>% filter(CA)
baseline_output %>% filter(CA=120)
baseline_output %>% filter(CA == 120)
baseline_output %>% filter(CA == 120, time == 1)
baseline_output %>% filter( time == 1)
baseline_output %>% gruop_by(CA)
baseline_output %>% group_by(CA)
baseline_output %>% group_by(CA) %>% filter(time == 1)
?group_by
reticulate::repl_python()
print("Hello")
n
